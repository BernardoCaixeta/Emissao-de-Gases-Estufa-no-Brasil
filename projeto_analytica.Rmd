---
title: "R Notebook"
output: html_notebook
---

```{r}
library(prophet)
library(basedosdados)

```

```{r}
set_billing_id('projeto-analytics-314021')
query <- "SELECT * FROM `basedosdados.br_seeg_emissoes.brasil`"
df <- read_sql(query)

```

```{r}
anos <- as.data.frame(df[1])
nivel_1 <- list()

contador = 1
for(i in 1:454850){
    if (!df['nivel_1'][i,] %in% nivel_1) {
        nivel_1[contador] <- df['nivel_1'][i,]
        contador <- contador + 1
    }
  }

ds <- seq(as.Date("1970/1/1"), as.Date("2019/1/1"), by = "year")
ds <- format(ds, format = "%Y")

## Agropecuária

emissoes <- as.list(rep(0, 50))
agropecuaria <- data.frame(ds) 

for(i in 1:454850){
    if(df['nivel_1'][i,] == 'Agropecuária' && !apply(df['emissao'][i,], 1, is.na)) {
      indice = match(toString(anos[i,]), agropecuaria['ano'][,1])
      emissoes[indice] <- emissoes[indice] + df['emissao'][i,]
  }
}
agropecuaria$y <- emissoes

m <- prophet(agropecuaria, changepoint.prior.scale = 0.1 , daily.seasonality = F, weekly.seasonality = F, interval.width = 0.2, seasonality.mode = "multiplicative")
future <- make_future_dataframe(m, periods = 5, freq = 'year')
predicao <- predict(m, future)
plot(m, predicao, ylab = "Quantidade de Gases Emitidos", xlab = "")


```




















